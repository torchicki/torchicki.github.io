"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3961],{4154:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>o});var r=t(5893),s=t(1151);const l={slug:"https-web-server",title:"NGINX\u3068Let\u2018s Encrypt\u3092\u5229\u7528\u3057\u305fHTTPS\u30b5\u30fc\u30d0\u306e\u69cb\u7bc9",authors:"awalo",tags:["Linux","nginx","letsencrypt"]},i=void 0,c={permalink:"/blog/https-web-server",source:"@site/blog/2024-02-18-https-web-server.md",title:"NGINX\u3068Let\u2018s Encrypt\u3092\u5229\u7528\u3057\u305fHTTPS\u30b5\u30fc\u30d0\u306e\u69cb\u7bc9",description:"NGINX\u306bLet's Encrypt\u3067\u53d6\u5f97\u3057\u305f\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u9069\u7528\u3057\u3001HTTPS\u30b5\u30fc\u30d0\u3092\u5efa\u3066\u308b\u305f\u3081\u306e\u624b\u9806",date:"2024-02-18T00:00:00.000Z",formattedDate:"2024\u5e742\u670818\u65e5",tags:[{label:"Linux",permalink:"/blog/tags/linux"},{label:"nginx",permalink:"/blog/tags/nginx"},{label:"letsencrypt",permalink:"/blog/tags/letsencrypt"}],readingTime:2.52,hasTruncateMarker:!1,authors:[{name:"\u3042\u308f\u308d",key:"awalo"}],frontMatter:{slug:"https-web-server",title:"NGINX\u3068Let\u2018s Encrypt\u3092\u5229\u7528\u3057\u305fHTTPS\u30b5\u30fc\u30d0\u306e\u69cb\u7bc9",authors:"awalo",tags:["Linux","nginx","letsencrypt"]},unlisted:!1,nextItem:{title:"logrotate\u306e\u51e6\u7406\u9806\u306e\u691c\u8a3c",permalink:"/blog/logrotate"}},a={authorsImageUrls:[void 0]},o=[{value:"\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u306e\u6e96\u5099",id:"\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u306e\u6e96\u5099",level:2},{value:"NGINX\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",id:"nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",level:3},{value:"certbot\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",id:"certbot\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",level:3},{value:"\u8a3c\u660e\u66f8\u306e\u53d6\u5f97",id:"\u8a3c\u660e\u66f8\u306e\u53d6\u5f97",level:2},{value:"\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u30b3\u30de\u30f3\u30c9",id:"\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u30b3\u30de\u30f3\u30c9",level:3},{value:"\u30b5\u30fc\u30d0\u306eHTTPS\u5316",id:"\u30b5\u30fc\u30d0\u306ehttps\u5316",level:2},{value:"NGINX\u306e\u8a2d\u5b9a",id:"nginx\u306e\u8a2d\u5b9a",level:3},{value:"\u8a3c\u660e\u66f8\u306e\u66f4\u65b0",id:"\u8a3c\u660e\u66f8\u306e\u66f4\u65b0",level:2},{value:"\u8a3c\u660e\u66f8\u66f4\u65b0\u306e\u305f\u3081\u306e\u8a2d\u5b9a\u5909\u66f4",id:"\u8a3c\u660e\u66f8\u66f4\u65b0\u306e\u305f\u3081\u306e\u8a2d\u5b9a\u5909\u66f4",level:3},{value:"\u8a3c\u660e\u66f8\u66f4\u65b0\u306e\u81ea\u52d5\u5316",id:"\u8a3c\u660e\u66f8\u66f4\u65b0\u306e\u81ea\u52d5\u5316",level:3}];function d(e){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"NGINX\u306bLet's Encrypt\u3067\u53d6\u5f97\u3057\u305f\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u9069\u7528\u3057\u3001HTTPS\u30b5\u30fc\u30d0\u3092\u5efa\u3066\u308b\u305f\u3081\u306e\u624b\u9806"}),"\n",(0,r.jsx)(n.h2,{id:"\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u306e\u6e96\u5099",children:"\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u306e\u6e96\u5099"}),"\n",(0,r.jsx)(n.p,{children:"NGINX\u3068Let's Encrypt\u3092\u5229\u7528\u3057\u305f\u7f72\u540d\u6240\u4f5c\u6210\u30c4\u30fc\u30eb\uff08certbot\uff09\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",children:"NGINX\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"yum install nginx"})}),"\n",(0,r.jsx)(n.h3,{id:"certbot\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",children:"certbot\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"yum install certbot"})}),"\n",(0,r.jsx)(n.h2,{id:"\u8a3c\u660e\u66f8\u306e\u53d6\u5f97",children:"\u8a3c\u660e\u66f8\u306e\u53d6\u5f97"}),"\n",(0,r.jsx)(n.h3,{id:"\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u30b3\u30de\u30f3\u30c9",children:"\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u30b3\u30de\u30f3\u30c9"}),"\n",(0,r.jsxs)(n.p,{children:["\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u3092certbot\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u884c\u3046\u3002",(0,r.jsx)(n.br,{}),"\n","\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306f80\u756a\u30dd\u30fc\u30c8\u3067Let's Encrypt \u304b\u3089\u306e\u901a\u4fe1\u3092\u5f85\u3061\u53d7\u3051\u3001\u5fc5\u8981\u306a\u901a\u4fe1\u3092\u884c\u3046\u3002",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"certbot certonly --standalone -d <\u30c9\u30e1\u30a4\u30f3\u540d> -m <\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9> --agree-tos -n"})]}),"\n",(0,r.jsx)(n.h2,{id:"\u30b5\u30fc\u30d0\u306ehttps\u5316",children:"\u30b5\u30fc\u30d0\u306eHTTPS\u5316"}),"\n",(0,r.jsx)(n.h3,{id:"nginx\u306e\u8a2d\u5b9a",children:"NGINX\u306e\u8a2d\u5b9a"}),"\n",(0,r.jsx)(n.p,{children:"NGINX\u306bSSL\u8a2d\u5b9a\u3068\u8a3c\u660e\u66f8\u9375\u306e\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u8a18\u8f09\u3059\u308b\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'server {\r\n..<\u4e2d\u7565>..\r\n    listen       443 ssl http2;\r\n    listen       [::]:443 ssl http2;\r\n    ssl_certificate "/etc/letsencrypt/live/<Domain\u540d>/fullchain.pem";\r\n    ssl_certificate_key "/etc/letsencrypt/live/<Domain\u540d>/privkey.pem";\r\n..<\u4e2d\u7565>..\r\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0a\u8a18\u8a2d\u5b9a\u5f8c\u306bNGINX\u3092\u518d\u8d77\u52d5\u3057\u8a2d\u5b9a\u3092\u53cd\u6620\u3059\u308b\u3002",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"systemctl restart nginx"})]}),"\n",(0,r.jsx)(n.h2,{id:"\u8a3c\u660e\u66f8\u306e\u66f4\u65b0",children:"\u8a3c\u660e\u66f8\u306e\u66f4\u65b0"}),"\n",(0,r.jsx)(n.h3,{id:"\u8a3c\u660e\u66f8\u66f4\u65b0\u306e\u305f\u3081\u306e\u8a2d\u5b9a\u5909\u66f4",children:"\u8a3c\u660e\u66f8\u66f4\u65b0\u306e\u305f\u3081\u306e\u8a2d\u5b9a\u5909\u66f4"}),"\n",(0,r.jsxs)(n.p,{children:["Let's Encrypt\u3067\u53d6\u5f97\u3057\u305f\u8a3c\u660e\u66f8\u306e\u671f\u9593\u306f90\u65e5\u3068\u77ed\u3044\u305f\u3081\u3001\u5b9a\u671f\u7684\u306b\u66f4\u65b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002",(0,r.jsx)(n.br,{}),"\n","\u3057\u304b\u3057\u300180\u756a\u30dd\u30fc\u30c8\u306b\u95a2\u3057\u3066\u306f\u65e2\u306bNGINX\u3067\u5229\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u53d6\u5f97\u6642\u3068\u540c\u69d8\u306bcertbot\u304c80\u756a\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002",(0,r.jsx)(n.br,{}),"\n","\u305d\u306e\u305f\u3081\u3001Let's Encrypt\u306e\u8a3c\u660e\u66f8\u66f4\u65b0\u306b\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u306fHTTP\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u7528\u306bNGINX\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3059\u308b\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'server {\r\n    listen       80;\r\n    listen       [::]:80;\r\n\r\n    location ^~/.well-known/acme-challenge/ {\r\n    default_type "text/plain";\r\n    }\r\n\r\n    location / {\r\n    return 301 https://$host$request_uri;\r\n    }\r\n}\r\n\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u305d\u308c\u306b\u5408\u308f\u305b\u3066\u3001Let's Encrypt\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Options used in the renewal process\r\n[renewalparams]\r\nauthenticator = webroot\r\nwebroot_path = /usr/share/nginx/html,\r\n[[webroot_map]]\r\n<domain\u540d> = /usr/share/nginx/html\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u758e\u901a\u78ba\u8a8d\u306e\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u306a\u3044\u304b\u78ba\u8a8d\u3059\u308b\u3002",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"certbot renew --dry-run"})]}),"\n",(0,r.jsx)(n.h3,{id:"\u8a3c\u660e\u66f8\u66f4\u65b0\u306e\u81ea\u52d5\u5316",children:"\u8a3c\u660e\u66f8\u66f4\u65b0\u306e\u81ea\u52d5\u5316"}),"\n",(0,r.jsxs)(n.p,{children:["\u6708\u306b\u4e00\u56deanacron\u3092\u5229\u7528\u3057\u3066\u66f4\u65b0\u3092\u884c\u3046\u3088\u3046\u306b\u3059\u308b\u3002",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"yum install cronie-anacron"}),(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"systemctl enable anacron"}),(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"vi /etc/cron.monthly/letsencrypt.sh"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell:letsencrypt.sh",children:"#!/bin/sh\r\n\r\ncertbot renew > /dev/null\r\nwait\r\nsystemctl restart nginx\n"})}),"\n",(0,r.jsx)(n.p,{children:"[\u53c2\u8003\u30b5\u30a4\u30c8]"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://qiita.com/HeRo/items/f9eb8d8a08d4d5b63ee9",children:"Let's Encrypt \u3067 Nginx \u306bSSL\u3092\u8a2d\u5b9a\u3059\u308b"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>c,a:()=>i});var r=t(7294);const s={},l=r.createContext(s);function i(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);